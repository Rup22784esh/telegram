<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Telegram Member Adder</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <h1>Telegram Member Adder Dashboard</h1>
    <div class="container">
        <div class="form-container">
            <h2>Add New Account</h2>
            <form action="/add_session" method="post">
                <input type="text" name="phone" placeholder="Phone (+1234567890)" required>
                <input type="text" name="source" placeholder="Source Group Link" required>
                <input type="text" name="target" placeholder="Target Group Link" required>
                <input type="number" name="last_seen_filter" placeholder="Last Seen Days (e.g., 7)" value="7">
                <button type="submit">Add Account</button>
            </form>
        </div>
        <div class="sessions-container">
            <h2>Active Sessions</h2>
            <table>
                <thead>
                    <tr><th>Phone</th><th>Source</th><th>Target</th><th>Status</th><th>Added</th><th>Skipped</th><th>Actions</th></tr>
                </thead>
                <tbody>
                    {% for phone, data in sessions.items() %}
                    <tr>
                        <td>{{ data.phone }}</td>
                        <td>{{ data.source }}</td>
                        <td>{{ data.target }}</td>
                        <td id="status-{{ phone }}">
                            {% if data.flood_wait_until and time.time() < data.flood_wait_until %}
                                <span class="flood-wait countdown" data-end="{{ data.flood_wait_until }}"></span>
                            {% else %}
                                {{ data.status }}
                            {% endif %}
                        </td>
                        <td>{{ data.added or 0 }}</td>
                        <td>{{ data.skipped or 0 }}</td>
                        <td>
                            <form method="POST" action="/restart_session" style="display:inline;">
                                <input type="hidden" name="phone" value="{{ data.phone }}">
                                <button type="submit">Restart</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    <script>
    function updateTimers() {
        document.querySelectorAll(".countdown").forEach(el => {
            const end = parseFloat(el.dataset.end);
            const left = Math.max(0, Math.floor(end - (Date.now() / 1000)));
            if (left > 0) {
                const minutes = Math.floor(left / 60);
                const seconds = left % 60;
                el.innerText = `Flood wait: ${minutes}m ${seconds}s`;
            } else {
                el.innerText = "Ready to resume...";
                if (!el.classList.contains('reloading')) {
                    el.classList.add('reloading');
                    setTimeout(() => window.location.reload(), 2000);
                }
            }
        });
    }
    setInterval(updateTimers, 1000);
    document.addEventListener("DOMContentLoaded", updateTimers);
    </script>
</body>
</html>